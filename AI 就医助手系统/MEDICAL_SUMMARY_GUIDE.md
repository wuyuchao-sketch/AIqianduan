# AI 病例总结功能使用说明

## 功能概述

AI 病例总结功能为医生端界面提供了智能化的病例总结生成和管理能力，支持实时流式生成、历史记录管理和导出功能。

## 主要特性

### 1. 实时流式生成
- **实时推送**: 病例总结生成过程中，内容会实时推送到前端界面
- **流式显示**: 采用 Server-Sent Events (SSE) 技术，支持流式数据传输
- **动态更新**: 生成过程中界面会实时更新，显示生成进度和内容

### 2. 长期显示和存储
- **持久化存储**: 生成的病例总结会长期保存在系统中
- **历史记录**: 支持查看患者的所有历史病例总结
- **状态管理**: 跟踪每个总结的生成状态（生成中、已完成、生成失败）

### 3. 用户界面优化
- **专用面板**: 独立的病例总结面板，提供清晰的功能布局
- **状态指示**: 清晰的视觉指示器显示生成状态
- **响应式设计**: 支持不同屏幕尺寸的设备
- **无障碍支持**: 支持无障碍模式，提供更大字体和更好的对比度

## 使用流程

### 1. 选择患者
在医生端界面左侧患者列表中选择需要生成病例总结的患者。

### 2. 生成病例总结
1. 在病例总结面板中点击"生成总结"按钮
2. 系统会调用后端 API 开始生成过程
3. 界面会显示"实时生成中"状态，并展示生成进度
4. 内容会逐步显示在界面上，带有打字机效果

### 3. 查看和管理
- **实时查看**: 生成过程中可以实时查看已生成的内容
- **历史记录**: 在历史总结记录中查看所有已生成的总结
- **详情查看**: 点击"查看详情"可以在弹窗中查看完整内容
- **导出功能**: 支持将病例总结导出为文本文件

## 技术实现

### 前端组件
- `MedicalSummaryPanel.tsx`: 主要的病例总结面板组件
- `DoctorView.tsx`: 医生端主界面，集成病例总结功能
- `medical-summary.css`: 专用样式文件，提供动画和视觉效果

### 后端接口
- `POST /api/medical-summary/generate/{visitId}`: 生成病例总结（流式返回）
- `GET /api/medical-summary/visit/{visitId}`: 获取指定就诊的病例总结
- `POST /api/medical-summary/create`: 手动创建病例总结

### 数据流
1. 前端发起生成请求
2. 后端调用 AI 服务生成内容
3. 通过 SSE 实时推送生成内容
4. 前端接收并实时更新界面
5. 生成完成后保存到数据库

## 界面布局

### 病例总结面板位置
病例总结面板位于医生端界面的中右侧区域，在患者病情摘要下方，具体位置：
- 左侧：患者列表
- 中间上方：患者病情摘要
- 中间下方：**AI 病例总结面板**（新增）
- 右侧：语音问诊记录

### 面板内容
1. **标题栏**: 显示"AI 病例总结"标题和生成按钮
2. **实时生成区**: 显示正在生成的内容（如果有）
3. **历史记录区**: 显示历史病例总结列表
4. **空状态**: 当没有总结时显示引导信息

## 状态管理

### 生成状态
- `generating`: 正在生成中，显示实时内容和动画
- `completed`: 生成完成，显示完整内容
- `error`: 生成失败，显示错误信息和重试选项

### 视觉指示
- **生成中**: 紫色渐变背景，脉冲动画，打字机光标
- **已完成**: 绿色状态标识，完整内容显示
- **生成失败**: 红色状态标识，错误信息显示

## 无障碍功能

### 支持特性
- 大字体模式：`accessibilityMode` 属性控制
- 高对比度：专用的无障碍样式类
- 键盘导航：所有交互元素支持键盘操作
- 屏幕阅读器：语义化的 HTML 结构

### 启用方式
通过 `accessibilityMode` 属性启用无障碍模式：
```tsx
<MedicalSummaryPanel 
  accessibilityMode={true}
  // ... 其他属性
/>
```

## 导出功能

### 支持格式
- 文本文件 (.txt)：包含完整的病例总结内容
- 文件命名：`病例总结_患者姓名_生成日期.txt`

### 导出内容
- 患者基本信息
- 生成时间
- 完整的病例总结内容
- 生成状态信息

## 错误处理

### 常见错误
1. **网络连接失败**: 显示网络错误提示，提供重试选项
2. **API 调用失败**: 显示服务器错误信息
3. **生成超时**: 显示超时提示，允许重新生成
4. **内容为空**: 显示内容为空提示

### 恢复机制
- 自动重试：网络错误时自动重试
- 手动重试：提供重试按钮
- 降级处理：API 失败时使用备用方案

## 性能优化

### 前端优化
- 虚拟滚动：大量历史记录时使用虚拟滚动
- 内容缓存：已生成的内容进行本地缓存
- 懒加载：历史记录按需加载

### 后端优化
- 流式传输：减少首屏加载时间
- 内容压缩：减少传输数据量
- 缓存策略：合理的缓存机制

## 扩展功能

### 未来规划
1. **多语言支持**: 支持多种语言的病例总结生成
2. **模板定制**: 允许医生自定义病例总结模板
3. **协作功能**: 支持多医生协作编辑病例总结
4. **智能建议**: 基于历史数据提供诊断建议
5. **集成HIS**: 与医院信息系统深度集成

### 配置选项
- 生成长度控制
- 内容格式选择
- 自动保存设置
- 通知偏好设置